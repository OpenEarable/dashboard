<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>OpenEarable - Dashboard</title>

        <!-- CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css" integrity="sha512-oAvZuuYVzkcTc2dH5z1ZJup5OmSQ000qlfRvuoTTiyTBjwX1faoyearj8KdMq0LgsBTHMrRuMek7s+CxF8yE+w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        
        <style>
            /* General Styles */
            body {
                background: #161618;
                color: white !important;
            }

            .card {
                border-color: transparent;
                border-width: 0px;
                overflow: hidden;
                background: #36353b;
                color: b0b0b0;
            }

            .card-title {
                color: white;
            }

            .btn {
                border-width: 0px;
               
            }

            .btn:hover {
                border-width: 0px;
                opacity: 0.9;
            }

            .btn:disabled {
                opacity: 0.5;
            }

            a {
                color: white !important;
            }

            a:hover {
                color: white;
                opacity: 0.8;
            }


            /* Tooltip */
            .tooltip-indicator {
                background: white;
                min-width: 17px;
                min-height: 17px;
                max-width: 17px;
                max-height: 17px;
                border-radius: 50%;
                font-size: 0.8em;
                font-weight: bold;
                display: flex;
                justify-content: center;
                align-items: center;
                color: black;
            }

            .tooltip-inner {
                background-color: white !important;   
                color: black;
            }

            .tooltip .tooltip-arrow::before {
                --bs-tooltip-bg: white;
            }
            
            /* Connection Card */
            .btn-connect {
                background-color: #77F2A1 !important;
                color: black !important;
            }

            .btn-disconnect {
                background-color: #f27777 !important;
                color: black !important;
                display: none; /* default is hidden */
            }
            
            /* Audio Player Card */
            .btn-audio-controls {
                font-size: 1.3em;
            }

            .btn-play {
                background-color: #77F2A1 !important; 
                color: black !important;
            }

            .btn-pause {
                background-color: #e0f277 !important; 
                color: black !important;
            }

            .btn-stop {
                background-color: #f27777 !important; 
                color: black !important;
            }

            /* Sensor Control Card */
            .btn-control {
                background-color: #53515b !important;
                color: white !important;
            }

            /* Log card */
            .btn-clear {
                background-color: white !important;
                padding: 2px 4px;
                font-size: 0.8em;
                color: black !important;
            }

            
        </style>
    </head>

    <body class="p-3 pt-4">
        <div class="container-fluid d-flex flex-column h-100">
            <div class="row gx-2">
                <div class="col-2 d-flex align-items-stretch flex-column">
                    <div class="card" style="background: transparent;;">
                        <div class="card-body d-flex justify-content-center align-items-center">
                            <div><h5 class="m-0 text-white" style=" color: white !important"><img style="height: 30px" src="logo.png"><span class="ms-2">OpenEarable</span></h5></div>
                            </div>
                    </div>
                    <div class="card mt-2 flex-fill">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <div class="d-flex flex-row w-100 justify-content-between">
                                <h5 class="card-title">Device Connection</h5>
                                <div class="tooltip-indicator" data-toggle="tooltip" title="OpenEarable connects via WebBLE. Make sure your browser supports WebBLE (e.g., Chrome version â‰¥ 56)."><div>?</div></div>
                            </div>
                            <p class="card-text"><i>OpenEarable not connected.</i></p>
                            <div>
                                <button id="connectDeviceButton" class="btn btn-connect w-100" onclick="onConnectDevice()">Connect</button>
                                <button id="disconnectDeviceButton" class="btn btn-disconnect w-100" onclick="onDisconnectDevice()">Disconnect</button>
                            </div>
                        </div>
                    </div>
                    
                    
                </div>
                <div class="col-4">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <div>
                                <div class="d-flex flex-row w-100 justify-content-between">
                                    <h5 class="card-title">Audio Player </h5>
                                    <div class="tooltip-indicator" data-toggle="tooltip" title="Audio files are played locally from the microSD card inside OpenEarable. The supported file formats are single channel, 16-bit, 44.1 kHz *.wav files."><div>?</div></div>
                                </div>
                            
                                <p class="card-text">Play audio file from the microSD card or a constant tone.</p>
                            </div>

                            <div>
                                <div class="d-flex flex-row w-100 justify-content-between">
                                <div class="d-flex flex-row">
                                    <button class="btn btn-audio-controls btn-play is-connect-enabled" disbaled onclick="onPlay()"><i class="bi bi-play"></i></button>  
                                </div>
                                <input id="fileNameInput" class="is-connect-enabled ms-1 w-100" placeholder="filename.wav">
                                <button class="btn btn-audio-controls btn-pause is-connect-enabled ms-3" disbaled onclick="onPause()"><i class="bi bi-pause"></i></button>
                                <button class="btn btn-audio-controls btn-stop is-connect-enabled ms-1" disbaled onclick="onStop()"><i class="bi bi-stop"></i></button>
                                </div>
                                <hr/>
                                <div class="d-flex flex-row align-items-center justify-content-between">
                                <div class="d-flex flex-row w-100">
                                    <button class="btn btn-audio-controls btn-play is-connect-enabled"><i class="bi bi-play"></i></button>
                                    <input min="300" max="22000" value="440" type="number" class="ms-1 is-connect-enabled w-100" value="0">
                                </div>
                                
                                <div class="d-flex flex-row align-items-center">
                                    <div class="ms-1 is-connect-enabled me-4">Hz</div>
                                </div>
                                
                                
                                <button class="btn btn-audio-controls btn-stop ms-3 is-connect-enabled"><i class="bi bi-stop"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex flex-row w-100 justify-content-between">
                                <h5 class="card-title">Sensor Control</h5>
                                <div class="tooltip-indicator" data-toggle="tooltip" title="TODO"><div>?</div></div>
                            </div>
                            <div class="d-flex flex-column">
                                <p class="card-text">Select the audio file to play from the microSD card.</p>
                                <div class="d-flex flex-row justify-content-between">
                                    <div class="d-flex flex-row">
                                        <input type="checkbox" class="is-connect-enabled">
                                        <div class="ms-2">Acc, Gyr, Mag, Pres, Tmp (via BLE)</div>
                                    </div>
                                    <div class="d-flex flex-row" style="width: 120px">
                                        <select class="ms-3 w-100 is-connect-enabled" name="sensorSamplingRate" id="sensorSamplingRate">
                                            <option value="0">0</option>
                                            <option value="10">10</option>
                                            <option value="20">20</option>
                                            <option value="30">30</option>
                                        </select>
                                        <div class="ms-1">Hz</div>
                                    </div>
                                </div>
                                <div class="d-flex flex-row justify-content-between mt-2">
                                    <div class="d-flex flex-row">
                                        <input type="checkbox" class="is-connect-enabled">
                                        <div class="ms-2">Microphone (written to SD card)</div>
                                       
                                    </div>
                                    <div class="d-flex flex-row" style="width: 120px">
                                        <select class="ms-3 w-100 is-connect-enabled" name="sensorSamplingRate" id="sensorSamplingRate">
                                            <option value="0">0</option>
                                            <option value="16000">16,000</option>
                                            <option value="41667">41,667</option>
                                            <option value="62500">62,500</option>
                                        </select>
                                        <div class="ms-1">Hz</div>
                                    </div>
                                </div>
                                <div class="d-flex flex-row mt-3 w-100 justify-content-between">
                                    <button class="btn btn-control is-connect-enabled">Set Configuration</button>
                                    <button class="btn btn-stop is-connect-enabled">Off</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>       
                <div class="col-2 d-flex flex-column">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex flex-row w-100 justify-content-between">
                                <h5 class="card-title">RGB LED Control</h5>
                                <div class="tooltip-indicator" data-toggle="tooltip" title="TODO"><div>?</div></div>
                            </div>
                            <div class="d-flex flex-row justify-content-between align-items-center">
                                <div class="d-flex flex-row justify-content-center align-items-center">
                                    <input class="is-connect-enabled" type="color" id="colorpicker" value="#ffffff">
                                    <button class="btn btn-control ms-2 is-connect-enabled">Set Color</button>
                                </div>

                                <button class="btn btn-stop is-connect-enabled">Off</button>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-2 flex-fill">
                        <div class="card-body">
                            <div class="d-flex flex-row w-100 justify-content-between">
                                <h5 class="card-title">Web Recorder</h5>
                                <div class="tooltip-indicator" data-toggle="tooltip" title="TODO"><div>?</div></div>
                            </div>
                            <div class="d-flex flex-row justify-content-between align-items-center">
                                <button class="btn btn-control is-connect-enabled">Start Recording</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-2 gx-2 flex-grow-1" style="flex-basis: 0;">
                <div class="col-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex flex-row w-100 justify-content-between">
                                <h5 class="card-title">Accelerometer</h5>
                                <div class="tooltip-indicator" data-toggle="tooltip" title="OpenEarable connects via WebBLE. Make sure your browser supports WebBLE (e.g., Chrome version â‰¥ 56)."><div>?</div></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex flex-row w-100 justify-content-between">
                                <h5 class="card-title">Gyroscope</h5>
                                <div class="tooltip-indicator" data-toggle="tooltip" title="OpenEarable connects via WebBLE. Make sure your browser supports WebBLE (e.g., Chrome version â‰¥ 56)."><div>?</div></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex flex-row w-100 justify-content-between">
                                <h5 class="card-title">Magnetometer</h5>
                                <div class="tooltip-indicator" data-toggle="tooltip" title="OpenEarable connects via WebBLE. Make sure your browser supports WebBLE (e.g., Chrome version â‰¥ 56)."><div>?</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-2 gx-2 flex-grow-1" style="flex-basis: 0;">
                <div class="col-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex flex-row w-100 justify-content-between">
                                <h5 class="card-title">Pressure Sensor</h5>
                                <div class="tooltip-indicator" data-toggle="tooltip" title="OpenEarable connects via WebBLE. Make sure your browser supports WebBLE (e.g., Chrome version â‰¥ 56)."><div>?</div></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex flex-row w-100 justify-content-between">
                                <h5 class="card-title">Temperature Sensor</h5>
                                <div class="tooltip-indicator" data-toggle="tooltip" title="OpenEarable connects via WebBLE. Make sure your browser supports WebBLE (e.g., Chrome version â‰¥ 56)."><div>?</div></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card h-100">
                        <div class="card-body h-100">
                            <div class="d-flex flex-row w-100 justify-content-between">
                                <h5 class="card-title">3D Model</h5>
                                <div class="tooltip-indicator" data-toggle="tooltip" title="OpenEarable connects via WebBLE. Make sure your browser supports WebBLE (e.g., Chrome version â‰¥ 56)."><div>?</div></div>
                            </div>
                            <model-viewer class="w-100 flex-fill" src="./OpenEarableModel.glb" auto-rotate camera-controls></model-viewer>

                        </div>
                    </div>
                </div>
            </div>
            <div class="d-flex flex-column w-100">
                
                <div class="card mt-2">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex flex-row w-100 justify-content-between">
                            <div class="d-flex flex-row justify-content-center align-items-center">
                                <div><h5 class="card-title">Log </h5></div>
                                <div class="btn btn-clear ms-2" onclick="onClearLog()">Clear</div>
                            </div>
                            
                            <div class="tooltip-indicator" data-toggle="tooltip" title="TODO"><div>?</div></div>
                        </div>
                        
                        <div id="log" class="w-100 p-2 mt-3" style="color: white; min-height: 150px; max-height: 150px; font-family: 'Courier New', Courier, monospace; border: 1px solid rgb(94, 94, 94); border-radius: 0.375rem; overflow-y: scroll; overflow-x: hidden;">

                        </div>  
                    </div>
                </div>
            </div>
        </div>
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.1.1/model-viewer.min.js"></script>

        <script>
            /* initialization tasks */
            $( document ).ready(function() {
                // enable tooltips
                $(function () {
                    $('[data-toggle="tooltip"]').tooltip()
                })

                // disable all buttons on initial load
                $(".is-connect-enabled").prop('disabled', true);

                // check if bluetooth is supported
                if ('bluetooth' in navigator) {
                    log('Your browser supports WebBLE. You are ready to connect to OpenEarable!');
                } else {
                    log('Your browser does not support WebBLE. Enable it or download a browser that supports WebBLE (e.g., Chrome version â‰¥ 56)!', "ERROR");
                }
            });
            

            

            /* connection */
            function onConnectDevice() {
                log("Connecting device.", type="MESSAGE")

                $('#connectDeviceButton').hide()
                $('#disconnectDeviceButton').show()

                onConnected(); // TODO: move to the location where the device actually connects
            }

            function onDisconnectDevice() {
                log("Disconnecting device.", type="MESSAGE")

                $('#disconnectDeviceButton').hide()
                $('#connectDeviceButton').show()

                onDisconnected(); // TODO: move to the location where the device actually disconnects
            }

            function onConnected() {
                log("Device connected.", type="SUCCESS")

                $(".is-connect-enabled").prop('disabled', false);
            }

            function onDisconnected() {
                log("Device disconnected.", type="SUCCESS")

                $(".is-connect-enabled").prop('disabled', true);
            }

            /* audio controls */
            function onPlay() {
                var fileName = $('#fileNameInput').val();

                if (fileName === "") log("File name is empty. If a file is already playing, this command will stop the current audio.", type="WARNING")
                else if (!fileName.endsWith('.wav')) log("File name is missing the '.wav' ending. Make sure its correct!", type="WARNING")

                log("Sending 'Play' with file name '" + fileName + "'.", type="MESSAGE")
            }

            function onPause() {
                log("Sending 'Pause'.", type="MESSAGE")
            }

            function onStop() {
                log("Sending 'Stop'.", type="MESSAGE")
            }

            /* logging */
            function log(message, type="MESSAGE") {
                var typeColorMap = {
                    "ERROR": "#f27777",
                    "WARNING": "#e0f277",
                    "SUCCESS": "#77F2A1",
                    "MESSAGE": "#aaa",
                }
                
                $("#log").prepend(`<div style="color: ${typeColorMap[type]}"><b>${(new Date().toISOString().replace('T', ' ').substring(0, 23)) } - ${type}:</b> <span style="color: white;">${message}</span></div>`)
            }

            function onClearLog() {
                $('#log').empty();
            }
        </script>
    </body>
</html>
 